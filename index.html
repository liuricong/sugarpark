<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta
      id="viewport"
      name="viewport"
      content="width=device-width,user-scalable=no,target-densitydpi=high-dpi"
    />
    <script src="js/require.js"></script>
    <title>一个都不能死游戏</title>

    <style type="text/css">
      body {
        margin: 0px;
        padding: 0px;
        overflow: hidden;
      }

			.btn {
				position: fixed;
				bottom: 0;
				left: 50%;
				transform: translateX(-50%);
			}
    </style>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
		<script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script type="text/javascript" src="js/main.js"></script>
  </head>
  <body>
    <div style="text-align: center">
      <canvas
        id="linkScreen"
        width="1366"
        height="621"
        style="width: 1366px; height: 621px"
      >
        很遗憾，您的浏览器不支持HTML5，请使用支持HTML5的浏览器。
      </canvas>

			<div id="ton-connect" class="btn" onclick="toWallet();">connectToWallet</div>
    </div>

		<script>
			// Init TWA
			Telegram.WebApp.ready();

			// Event occurs whenever theme settings are changed in the user's Telegram app (including switching to night mode).
			Telegram.WebApp.onEvent('themeChanged', function() {
					document.documentElement.className = Telegram.WebApp.colorScheme;
			});

			// Show main button
			Telegram.WebApp.MainButton.setParams({
					text: 'Main Button'
			});
			Telegram.WebApp.MainButton.onClick(function () {
					Telegram.WebApp.showAlert('Main Button was clicked')
			});	
			Telegram.WebApp.MainButton.show();

			// Function to call showPopup API
			function showPopup() {
					Telegram.WebApp.showPopup({
							title: 'Title',
							message: 'Some message',
							buttons: [
									{id: 'link', type: 'default', text: 'Open ton.org'},
									{type: 'cancel'},
							]
					}, function(btn) {
							if (btn === 'link') {
									Telegram.WebApp.openLink('https://ton.org/');
							}
					});
			};

			// Function to toggle main TWA button
			function toggleMainButton() {
					if (Telegram.WebApp.MainButton.isVisible) {
							Telegram.WebApp.MainButton.hide();
					} else {
							Telegram.WebApp.MainButton.show();
					}
			};

			function setViewportData() {
					var sizeEl = document.getElementById('viewport-params-size');
					sizeEl.innerText = 'width: ' + window.innerWidth + ' x ' + 
							'height: ' + Telegram.WebApp.viewportStableHeight;

					var expandEl = document.querySelector('#viewport-params-expand');
					expandEl.innerText = 'Is Expanded: ' + (Telegram.WebApp.isExpanded ? 'true' : 'false');
			}

			Telegram.WebApp.setHeaderColor('secondary_bg_color');

			setViewportData();
			Telegram.WebApp.onEvent('viewportChanged', setViewportData);

			Telegram.WebApp.onEvent('themeChanged', function() {
					document.body.setAttribute('style', '--bg-color:' + Telegram.WebApp.backgroundColor);
			});

			const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
					manifestUrl: 'https://liuricong.github.io/sugarpark/tonconnect-manifest.json',
					buttonRootId: 'ton-connect',
					twaReturnUrl: 'https://t.me/sugartest'
			});

			async function connectToWallet() {
        const connectedWallet = await tonConnectUI.connectWallet();
        // 如果需要，可以对connectedWallet做一些事情
        console.log(connectedWallet);
    	}

			function toWallet() {
				connectToWallet().catch(error => {
            console.error("Error connecting to wallet:", error);
        });
			}
		</script>
  </body>
</html>
